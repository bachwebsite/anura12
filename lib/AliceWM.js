"use strict";const windowInformation={};const windowID=0;class WindowInformation{title;width;minwidth;height;minheight;allowMultipleInstance=false;}
class WMWindow{element;content;maximized;oldstyle;dragging=false;originalLeft;originalTop;width;height;mouseLeft;mouseTop;wininfo;state;onfocus;onresize;justresized=false;mouseover=false;maximizeImg;constructor(wininfo){this.wininfo=wininfo;this.state=stateful({title:wininfo.title,});this.element=(React.createElement("div",{class:"aliceWMwin opacity0",style:`
                    width: ${wininfo.width};
                    height: ${wininfo.height};
                `,"on:mouseover":()=>{this.mouseover=true;},"on:mouseout":()=>{this.mouseover=false;},"on:mousedown":this.focus.bind(this)},React.createElement("div",{class:"resizers"},React.createElement("div",{class:"resize-edge left"}),React.createElement("div",{class:"resize-edge right"}),React.createElement("div",{class:"resize-edge top"}),React.createElement("div",{class:"resize-edge bottom"}),React.createElement("div",{class:"resize-corner top-left"}),React.createElement("div",{class:"resize-corner top-right"}),React.createElement("div",{class:"resize-corner bottom-left"}),React.createElement("div",{class:"resize-corner bottom-right"})),React.createElement("div",{class:"title","on:mousedown":(evt)=>{deactivateFrames();this.dragging=true;this.originalLeft=this.element.offsetLeft;this.originalTop=this.element.offsetTop;this.mouseLeft=evt.clientX;this.mouseTop=evt.clientY;},"on:mouseup":(evt)=>{reactivateFrames();if(this.dragging){this.handleDrag(evt);this.dragging=false;}},"on:mousemove":(evt)=>{if(this.dragging){this.handleDrag(evt);}}},React.createElement("div",{class:"titleContent"},React.use(this.state.title)),React.createElement("button",{class:"windowButton","on:click":()=>{this.minimize();}},React.createElement("img",{src:"/assets/window/minimize.svg",height:"12px",class:"windowButtonIcon"})),React.createElement("button",{class:"windowButton","on:click":this.maximize.bind(this)},React.createElement("img",{src:"/assets/window/maximize.svg","bind:maximizeImg":this,height:"12px",class:"windowButtonIcon"})),React.createElement("button",{class:"windowButton","on:click":this.close.bind(this)},React.createElement("img",{src:"/assets/window/close.svg",height:"12px",class:"windowButtonIcon"}))),React.createElement("div",{class:"content","bind:content":this,style:"width: 100%; padding:0; margin:0;"})));this.width=parseFloat(getComputedStyle(this.element,null).getPropertyValue("width").replace("px",""));this.height=parseFloat(getComputedStyle(this.element,null).getPropertyValue("height").replace("px",""));document.addEventListener("mousemove",(evt)=>{if(this.dragging){this.handleDrag(evt);}});window.addEventListener("blur",()=>{if(this.mouseover){this.focus();}});document.addEventListener("mouseup",(evt)=>{reactivateFrames();evt=evt||window.event;if(this.dragging){this.handleDrag(evt);this.dragging=false;}});const resizers=[...this.element.querySelectorAll(".resize-corner"),...this.element.querySelectorAll(".resize-edge"),];const minimum_size=20;let original_width=0;let original_height=0;let original_x=0;let original_y=0;let original_mouse_x=0;let original_mouse_y=0;let sentResize=false;for(let i=0;i<resizers.length;i++){const currentResizer=resizers[i];currentResizer.addEventListener("mousedown",(e)=>{e.preventDefault();original_width=parseFloat(getComputedStyle(this.element,null).getPropertyValue("width").replace("px",""));original_height=parseFloat(getComputedStyle(this.element,null).getPropertyValue("height").replace("px",""));deactivateFrames();original_x=this.element.getBoundingClientRect().left;original_y=this.element.getBoundingClientRect().top;original_mouse_x=e.pageX;original_mouse_y=e.pageY;window.addEventListener("mousemove",resize);window.addEventListener("mouseup",()=>{reactivateFrames();window.removeEventListener("mousemove",resize);if(!sentResize){this.onresize(this.width,this.height);sentResize=true;}});});const resize=(e)=>{sentResize=false;if(this.maximized){this.unmaximize();}
if(currentResizer.classList.contains("bottom-right")){const width=original_width+(e.pageX-original_mouse_x);const height=original_height+(e.pageY-original_mouse_y);if(width>minimum_size){this.element.style.width=width+"px";}
if(height>minimum_size){this.element.style.height=height+"px";}}
else if(currentResizer.classList.contains("bottom-left")){const height=original_height+(e.pageY-original_mouse_y);const width=original_width-(e.pageX-original_mouse_x);if(height>minimum_size){this.element.style.height=height+"px";}
if(width>minimum_size){this.element.style.width=width+"px";this.element.style.left=original_x+(e.pageX-original_mouse_x)+"px";}}
else if(currentResizer.classList.contains("top-right")){const width=original_width+(e.pageX-original_mouse_x);const height=original_height-(e.pageY-original_mouse_y);if(width>minimum_size){this.element.style.width=width+"px";}
if(height>minimum_size){this.element.style.height=height+"px";this.element.style.top=original_y+(e.pageY-original_mouse_y)+"px";}}
else if(currentResizer.classList.contains("top-left")){const width=original_width-(e.pageX-original_mouse_x);const height=original_height-(e.pageY-original_mouse_y);if(width>minimum_size){this.element.style.width=width+"px";this.element.style.left=original_x+(e.pageX-original_mouse_x)+"px";}
if(height>minimum_size){this.element.style.height=height+"px";this.element.style.top=original_y+(e.pageY-original_mouse_y)+"px";}}
else if(currentResizer.classList.contains("left")){const width=original_width-(e.pageX-original_mouse_x);if(width>minimum_size){this.element.style.width=width+"px";this.element.style.left=original_x+(e.pageX-original_mouse_x)+"px";}}
else if(currentResizer.classList.contains("right")){const width=original_width+(e.pageX-original_mouse_x);if(width>minimum_size){this.element.style.width=width+"px";}}
else if(currentResizer.classList.contains("top")){const width=original_height-(e.pageY-original_mouse_y);if(width>minimum_size){this.element.style.height=width+"px";this.element.style.top=original_y+(e.pageY-original_mouse_y)+"px";}}
else if(currentResizer.classList.contains("bottom")){const height=original_height+(e.pageY-original_mouse_y);if(height>minimum_size){this.element.style.height=height+"px";}}
this.width=parseFloat(getComputedStyle(this.element,null).getPropertyValue("width").replace("px",""));this.height=parseFloat(getComputedStyle(this.element,null).getPropertyValue("height").replace("px",""));};}
setTimeout(()=>this.element.classList.remove("opacity0"),10);}
handleDrag(evt){this.element.style.left=Math.min(window.innerWidth,Math.max(0,this.originalLeft+evt.clientX-this.mouseLeft))+"px";this.element.style.top=Math.min(window.innerHeight,Math.max(0,this.originalTop+evt.clientY-this.mouseTop))+"px";if(this.maximized){this.unmaximize();this.originalLeft=this.element.offsetLeft;this.originalTop=this.element.offsetTop;this.mouseLeft=evt.clientX;this.mouseTop=evt.clientY;}}
focus(){this.element.style.setProperty("z-index",(getHighestZindex()+1).toString());normalizeZindex();if(this.onfocus)
this.onfocus();}
close(){this.element.remove();anura.removeStaleApps();}
togglemaximize(){if(!this.maximized){this.maximize();}
else{this.unmaximize();}}
maximize(){if(this.maximized){return;}
this.oldstyle=this.element.getAttribute("style");const width=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;const height=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.element.style.top="0";this.element.style.left="0";this.element.style.width=`${width}px`;this.element.style.height=`${height-61}px`;this.maximizeImg.src="/assets/window/restore.svg";this.justresized=true;this.maximized=true;}
async unmaximize(){console.log("restoring");this.element.setAttribute("style",this.oldstyle);this.maximizeImg.src="/assets/window/maximize.svg";await sleep(10);this.justresized=true;this.maximized=false;}
minimize(){this.element.style.display="none";}
unminimize(){this.element.style.display="";}}
const AliceWM={create:function(givenWinInfo){let wininfo={title:"",minheight:40,minwidth:40,width:"1000px",height:"500px",allowMultipleInstance:false,};if(typeof givenWinInfo=="object")
wininfo=givenWinInfo;if(typeof givenWinInfo=="string")
wininfo.title=givenWinInfo;const win=new WMWindow(wininfo);document.body.appendChild(win.element);win.focus();return win;},};function deactivateFrames(){let i;const frames=document.getElementsByTagName("iframe");for(i=0;i<frames.length;++i){anura.logger.debug(frames[i]);frames[i].style.pointerEvents="none";}}
function reactivateFrames(){let i;const frames=document.getElementsByTagName("iframe");for(i=0;i<frames.length;++i){frames[i].style.pointerEvents="auto";}}
function getHighestZindex(){const allWindows=Array.from(document.querySelectorAll(".aliceWMwin"));anura.logger.debug(allWindows);let highestZindex=0;for(const wmwindow of allWindows){if(Number(wmwindow.style.getPropertyValue("z-index"))>=highestZindex)
highestZindex=Number(wmwindow.style.getPropertyValue("z-index"));}
return highestZindex;}
async function normalizeZindex(){const allWindows=Array.from(document.querySelectorAll(".aliceWMwin"));anura.logger.debug(allWindows);let lowestZindex=9999;for(const wmwindow of allWindows){if(Number(wmwindow.style.getPropertyValue("z-index"))<=lowestZindex)
lowestZindex=Number(wmwindow.style.getPropertyValue("z-index"));}
const normalizeValue=lowestZindex-1;for(const wmwindow of allWindows){wmwindow.style.setProperty("z-index",(Number(wmwindow.style.getPropertyValue("z-index"))-
normalizeValue).toString());}}
function center(element){if(element){element.style.left=(window.innerWidth-element.offsetWidth)/2+"px";element.style.top=(window.innerHeight-element.offsetHeight)/2+"px";}}